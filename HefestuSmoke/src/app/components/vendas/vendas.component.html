<main>
  <section class="cadastro">
    <div class="cadastro-container">
      <div *ngFor="let produto of produtos" class="produto-item">
        <div class="produto-info">
          <h2 class="produto-nome"><b>{{ produto.nomeProduto }}</b></h2>
          <img [src]="produto.imagemUrl" class="produto-imagem" />
        </div>
        <div class="produto-detalhes">
          <p class="produto-descricao">{{ produto.descricao }}</p>
          <p class="produto-marca"><b>{{ produto.marca }} ©</b></p>
          <button class="btn-comprar" (click)="openModal(produto)">Comprar</button>
          <div class="produto-acoes">
            <p class="produto-valor">{{ produto.valor | currency:'BRL' }}</p>
            <p class="quantidade">Unidades: {{ produto.quantidade }}</p>
          </div>
        </div>
      </div>
    </div>
    <div class="alternative-action fixed-action">
      <a class="custom-btn" [routerLink]="''">Voltar</a>
    </div>
  </section>

  <div class="modal" [ngClass]="{'is-active': isModalActive}">
    <div class="modal-background" (click)="closeModal()"></div>
    <div class="modal-content">
      <button class="modal-close" aria-label="close" (click)="closeModal()">&times;</button>
      <form (ngSubmit)="onSubmit()" #cadastroForm="ngForm">
        <h2>Compra</h2>

        <div class="form-group">
          <label for="nome">Nome no Cartão:</label>
          <input type="text" id="nome" name="nome" [(ngModel)]="cartao.nome" required #nome="ngModel">
          <div *ngIf="nome.invalid && nome.touched" class="error">Nome é obrigatório.</div>
        </div>

        <div class="form-group">
          <label for="numero">Número do Cartão:</label>
          <input type="text" id="numero" name="numero" [(ngModel)]="cartao.numero" required pattern="^[0-9]{16}$" #numero="ngModel">
          <div *ngIf="numero.invalid && numero.touched" class="error">Número do cartão inválido. Deve conter 16 dígitos.</div>
        </div>

        <div class="form-group">
          <label for="validade">Validade:</label>
          <input type="text" id="validade" name="validade" [(ngModel)]="cartao.validade" required pattern="^(0[1-9]|1[0-2])\/?([0-9]{4}|[0-9]{2})$" #validade="ngModel">
          <div *ngIf="validade.invalid && validade.touched" class="error">Validade inválida. Use o formato MM/AA.</div>
        </div>

        <div class="form-group">
          <label for="cvv">CVV:</label>
          <input type="text" id="cvv" name="cvv" [(ngModel)]="cartao.cvv" required pattern="^[0-9]{3,4}$" #cvv="ngModel">
          <div *ngIf="cvv.invalid && cvv.touched" class="error">CVV inválido. Deve conter 3 ou 4 dígitos.</div>
        </div>

        <button class="btn-comprar" type="submit" [disabled]="cadastroForm.invalid">Confirmar Compra</button>
      </form>
    </div>
  </div>
</main>
